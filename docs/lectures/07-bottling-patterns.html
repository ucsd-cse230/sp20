<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
 <!--
      loads the http over https ssl -
      welcome to my website!

	this theme is based off the Ice & Fire theme created by Lucas Gatsas
      https://www.twitter.com/LucasGatsas
      www.lucasgatsas.ch - switzerland.
  -->


<!-- Microsoft Internet Explorer documentMode compatMode setting IE Modus -->
<script type="text/javascript">
var IE = null;
if (window.navigator.appName == "Microsoft Internet Explorer") {
  if (document.documentMode) {

    IE = document.documentMode;
    } else {

        IE = 5;
          if (document.compatMode) {
      if (document.compatMode == "CSS1Compat")
      IE = 11;
      }
    }
  }
</script>

    <meta charset="utf-8">
    <!-- X-UA -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="X-UA-Compatible" content="IE=11" />
    <link rel="author" title="Ranjit Jhala" href="http://ranjitjhala.github.io" />

    <meta name="google" content="notranslate" />
    <!-- Viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- index ROBOTS follow -->
    <meta name="robots" content="index, follow" />
    <!-- Site Desciption -->
    <meta name="description" content="UCSD CSE 230">
    <!-- Site Desciption -->
    <meta name="keywords" content="haskell, refinement types, liquid types, formal methods, type systems">
    <!-- Favicon -->
    <link rel="shortcut icon" href="https://ucsd-cse230.github.io/sp20/static/img/ico.png" type="image/x-icon" />
    <!-- Blog Title -->
    <title>cse230</title>

    <!--     <title>{% if page.title %}{{ page.title }} - {{ site.title }}{% else %}{{ site.title }}{% endif %}</title>
-->
    <!-- Property Metas -->
    <meta property="og:image" content="https://ucsd-cse230.github.io/sp20/static/img/ix.png" />
    <meta property="og:title" content="UCSD CSE 230" />
    <meta property="og:site_name" content="UCSD CSE 230" />
    <!-- Canonical -->
    <link rel="canonical" href="{{ page.url | replace:'index.html','' | prepend: site.baseUrl | prepend: site.url }}">
    <!-- StyleSheet -->
    <link rel="stylesheet" href="https://ucsd-cse230.github.io/sp20/static/css/bootstrap.min.css">
    <!-- <link rel="stylesheet" href="https://ucsd-cse230.github.io/sp20/static/css/spaceg.stylesheets.css"> -->
    <link rel="stylesheet" href="https://ucsd-cse230.github.io/sp20/static/css/ronacher.css" type="text/css">

    <link rel="stylesheet" href="https://ucsd-cse230.github.io/sp20/static/css/syntax.css">
    <link rel="stylesheet" href="https://ucsd-cse230.github.io/sp20/static/css/liquid-light.css">

    <!-- Fonts
    <link href='https://fonts.googleapis.com/css?family=Merriweather:400,300,300italic,400italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Playfair+Display:400,700,900,400italic,700italic,900italic' rel='stylesheet' type='text/css'>
    -->

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>
	#preloader {position:fixed;top:0;left:0;right:0;bottom:0;background-color:#fff; /* change if the mask should have another color then white */z-index:99; /* makes sure it stays on top */}
	#status {width:200px;height:200px;position:absolute;left:50%; /* centers the loading animation horizontally one the screen */top:50%; /* centers the loading animation vertically one the screen */background-image:url("/static/img/preloader.gif"); /* path to your loading animation */background-repeat:no-repeat;background-position:center;margin:-100px 0 0 -100px; /* is width and height divided by two */}
	ul, ol {margin-top: 0;margin-bottom: 10px;}
	.navbar-inverse {background-color: #FFF;border-color: #FFFFFF;}
</style>
<!--link rel="stylesheet" href="https://ucsd-cse230.github.io/sp20/static/css/prettify.css"-->
<style>
  /* HEADER IMAGE */
  header.intro-header {background: #6f5499;background: no-repeat center center;background-attachment: scroll;-webkit-background-size: cover;-moz-background-size: cover;background-size: cover;-o-background-size: cover;}

	/* Preloader */#preloader {position:fixed;top:0;left:0;right:0;bottom:0;background-color:#fff; /* change if the mask should have another color then white */z-index:99; /* makes sure it stays on top */}
	#status {width:200px;height:200px;position:absolute;left:50%; /* centers the loading animation horizontally one the screen */top:50%; /* centers the loading animation vertically one the screen */background-image:; /* path to your loading animation */background-repeat:no-repeat;background-position:center;margin:-100px 0 0 -100px; /* is width and height divided by two */}
	li {list-style: none;}
            body.modal-open
            {overflow: hidden;padding-right: 0px;
        }
	article li {list-style: inherit;}
	article .figure {text-align: center}
    </style>
    <!-- end Loading front stylesheet here -->
    </head>

    <body>
	    
	<!-- 	
        <div id="preloader">
	    <div id="status">
	    </div>
	</div>  
	-->
	<!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ucsd-cse230.github.io/sp20" id="blog-title-left-top">cse230</a>
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li><a href="https://ucsd-cse230.github.io/sp20/calendar.html">Calendar</a></li>
                <li><a href="https://ucsd-cse230.github.io/sp20/contact.html">Contact</a></li>
                <li><a href="https://ucsd-cse230.github.io/sp20/grades.html">Grades</a></li>
                <li><a href="https://ucsd-cse230.github.io/sp20/lectures.html">Lectures</a></li>
                <li><a href="https://ucsd-cse230.github.io/sp20/assignments.html">Assignments</a></li>
                <li><a href="https://ucsd-cse230.github.io/sp20/links.html">Links</a></li>
                <li><a href="https://www.piazza.com/class/k8anl5ns5bldp" id="roundbutton" target="_blank"><i class="fa fa-twitter"></i>Piazza</a></li>
                <li><a href="https://canvas.ucsd.edu/courses/12823" id="roundbutton" target="_blank"><i class="fa fa-twitter"></i>Canvas</a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<!-- Portfolio Modals -->
    <div class="portfolio-modal modal fade" id="portfolioModal1" tabindex="-1" role="dialog" aria-hidden="true" style="padding-right:0px; overflow: hidden;">
        <div class="modal-content">
            <div class="close-modal" data-dismiss="modal">
                <div class="lr">
                    <div class="rl">
                    </div>
                </div>
            </div>
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 col-lg-offset-2">
                        <div class="modal-body">
                            <h1 class="font-style-inline-small-h1">Ranjit Jhala</h1>
                            <hr class="star-primary">
                            <img src="https://ucsd-cse230.github.io/sp20/static/img/ico.png" class="img-responsive img-centered" alt title>
                            <p class="font-style-inline-small">
                                <a href="https://www.twitter.com/ranjitjhala" target="_blank">follow me</a>. <br>
                                <a href="https://www.github.com/ranjitjhala" target="_blank">    <i class="fa fa-github" id="spaceg-social-modal"></i> </a>
                                <a href="https://www.twitter.com/ranjitjhala" target="_blank"><i class="fa fa-twitter" id="spaceg-social-modal"></i> </a>
                                <a href="https://plus.google.com/u/0/104385825850161331469" target="_blank"> <i class="fa fa-google-plus" id="spaceg-social-modal"></i></a>
                            </p>
                            <button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-times"></i> Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
<!-- Menu Modals Add New Sa.21.Feb.2015 03:22:25 -->
    <div class="portfolio-modal modal fade" id="portfolioModal2" tabindex="-1" role="dialog" aria-hidden="true" style="padding-right:0px; overflow: hidden;">
        <div class="modal-content">
            <div class="close-modal" data-dismiss="modal">
                <div class="lr">
                    <div class="rl">
                    </div>
                </div>
            </div>
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 col-lg-offset-2">
                        <div class="modal-body">
                            <h1 class="font-style-inline-small-h1">Ranjit Jhala</h1>
                            <hr class="star-primary">
                            <p class="font-style-inline-small">
                              <a href="https://www.twitter.com/ranjitjhala" target="_blank">follow</a>. <br>
                              <a href="https://www.github.com/ranjitjhala" target="_blank">    <i class="fa fa-github" id="spaceg-social-modal"></i> </a>
                              <li><a href="https://ucsd-cse230.github.io/sp20/calendar.html">Calendar</a></li>
                              <li><a href="https://ucsd-cse230.github.io/sp20/contact.html">Contact</a></li>
                              <li><a href="https://ucsd-cse230.github.io/sp20/grades.html">Grades</a></li>
                              <li><a href="https://ucsd-cse230.github.io/sp20/lectures.html">Lectures</a></li>
                              <li><a href="https://ucsd-cse230.github.io/sp20/assignments.html">Assignments</a></li>
                              <li><a href="https://ucsd-cse230.github.io/sp20/links.html">Links</a></li>
                              <li><a href="https://www.piazza.com/class/k8anl5ns5bldp" id="roundbutton" target="_blank"><i class="fa fa-twitter"></i>Piazza</a></li>
                              <li><a href="https://canvas.ucsd.edu/courses/12823" id="roundbutton" target="_blank"><i class="fa fa-twitter"></i>Canvas</a></li>
                            </p>
                            <button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-times"></i>Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


        <div id="content">
            <!-- Post Header -->
    <header class="intro-header" style="background-image: url('https://ucsd-cse230.github.io/sp20/static/img/sea.jpg')" alt title>

    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>Spotting Computation Patterns</h1>
                    
                    <span class="meta">
		    
		    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->


<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
			<p>HEREHEREHEREHERE</p>
<p>The tag-team of polymorphism and higher-order functions is the secret sauce that makes FP so tasty. It allows us to take arbitrary, <em>patterns of computation</em> that reappear in different guises in different places, and crisply specify them as safely reusable strategies. That sounds very woolly (I hope), lets look at some concrete examples.</p>
<h2 id="computation-pattern-iteration">Computation Pattern: Iteration</h2>
<p>Lets write a function that converts a string to uppercase. Recall that in Haskell, a <code class="sourceCode haskell"><span class="dt">String</span></code> is just a list of <code class="sourceCode haskell"><span class="dt">Char</span></code>. We must start with a function that will convert an individual <code class="sourceCode haskell"><span class="dt">Char</span></code> to its uppercase version. Once we find this function, we will simply <em>jog over the list</em>, and apply the function to each <code class="sourceCode haskell"><span class="dt">Char</span></code>.</p>
<p>How might we find such a transformer? Lets query <a href="http://haskell.org/hoogle" title="Hoogle Query: Char -&gt; Char">Hoogle</a> for a function of the appropriate type! Ah, we see that the module <code class="sourceCode haskell"><span class="dt">Data.Char</span></code> contains a function.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb1-1" data-line-number="1">toUpper<span class="ot"> ::</span> <span class="dt">Char</span> <span class="ot">-&gt;</span> <span class="dt">Char</span></a></code></pre></div>
<p>and so now, we can write the simple recursive function</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb2-1" data-line-number="1">toUpperString []     <span class="fu">=</span> []</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">toUpperString (c<span class="fu">:</span>cs) <span class="fu">=</span> toUpper c <span class="fu">:</span> toUpperString cs</a></code></pre></div>
<p>As you might imagine, this sort of recursion appears all over the place. For example, suppose I represent a using a pair of <code class="sourceCode haskell"><span class="dt">Double</span></code> (for the x- and y- coordinates.) and I have a list of points that represent a polygon.</p>

<p>Now, its easy to write a function that <em>shifts</em> a point by a specific amount</p>

<p>How would we translate a polygon? Just jog over all the points in the polygon and translate them individually</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="ot">shiftPoly ::</span> <span class="dt">XY</span> <span class="ot">-&gt;</span> <span class="dt">Polygon</span> <span class="ot">-&gt;</span> <span class="dt">Polygon</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"></a>
<a class="sourceLine" id="cb3-3" data-line-number="3">shiftPoly d []     <span class="fu">=</span> []</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">shiftPoly d (x<span class="fu">:</span>xs) <span class="fu">=</span> shiftXY d x <span class="fu">:</span> shiftPoly d xs</a>
<a class="sourceLine" id="cb3-5" data-line-number="5"></a>
<a class="sourceLine" id="cb3-6" data-line-number="6">uppercase []       <span class="fu">=</span> []</a>
<a class="sourceLine" id="cb3-7" data-line-number="7">uppercse (x<span class="fu">:</span>xs)   <span class="fu">=</span> toUpper x <span class="fu">:</span> uppercase xs</a>
<a class="sourceLine" id="cb3-8" data-line-number="8"></a>
<a class="sourceLine" id="cb3-9" data-line-number="9">shiftPoly d    <span class="fu">=</span> thing (shiftXY d)</a>
<a class="sourceLine" id="cb3-10" data-line-number="10">uppercase      <span class="fu">=</span> thing toUpper</a></code></pre></div>
<p>Now, in a lesser language, you might be quite happy with the above code. But what separates a good programmer from a great one, is the ability to <em>abstract</em>.</p>
<p>Like humans and monkeys, the functions <code class="sourceCode haskell">toUpperString</code> and <code class="sourceCode haskell">shiftPoly</code> <a href="http://www.livescience.com/health/070412_rhesus_monkeys.html">share 93% of their DNA</a> – the notion of <em>jogging</em> over the list. The common pattern is described by the polymorphic higher-order function <code class="sourceCode haskell">map</code></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb4-1" data-line-number="1">map f []     <span class="fu">=</span> []</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">map f (x<span class="fu">:</span>xs) <span class="fu">=</span> (f x) <span class="fu">:</span> (map f xs)</a></code></pre></div>
<p>How did we arrive at this? Well, you find what is enshrine in the function’s body that which is <em>common</em> to the different instances, namely the recursive jogging strategy; and the bits that are different, simply become the function’s parameters! Thus, the <code class="sourceCode haskell">map</code> function abstracts, or if you have a vivid imagination, locks up in a bottle, the extremely common pattern of jogging over the list.</p>
<figure>
<img src="../static/fairy.png" alt="Fairy In a Bottle" /><figcaption>Fairy In a Bottle</figcaption>
</figure>
<p>Verily, the type of <code class="sourceCode haskell">map</code> tells us exactly what it does</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb5-1" data-line-number="1">ghci<span class="fu">&gt;</span> <span class="fu">:</span><span class="kw">type</span> map</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">map<span class="ot"> ::</span> (a <span class="ot">-&gt;</span> b) <span class="ot">-&gt;</span> [a] <span class="ot">-&gt;</span> [b]</a></code></pre></div>
<p>That is, it takes an <code class="sourceCode haskell">a <span class="ot">-&gt;</span> b</code> transformer and list of <code class="sourceCode haskell">a</code> values, and transforms each value to return a list of <code class="sourceCode haskell">b</code> values. We can now safely reuse the pattern, by <em>instantiating</em> the transformer with different specific operations.</p>

<p>Much better.</p>
<p>By the way, what happened to the parameters of <code class="sourceCode haskell">toUpperString</code> and <code class="sourceCode haskell">shiftPoly</code>? Two words: <em>partial application</em>. In general, in Haskell, a function definition equation</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb6-1" data-line-number="1">f x <span class="fu">=</span> e x</a></code></pre></div>
<p>is identical to</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb7-1" data-line-number="1">f <span class="fu">=</span> e</a></code></pre></div>
<p>as long as <code class="sourceCode haskell">x</code> doesn’t appear in <code class="sourceCode haskell">e</code>. Thus, to save ourselves the trouble of typing, and the blight of seeing, the vestigial <code class="sourceCode haskell">x</code> we <em>often</em> prefer to just leave it out altogether.</p>
<p>As an exercise, to prove to yourself using just equational reasoning (using the different equality laws we have seen) that the above versions of <code class="sourceCode haskell">toUpperString</code> and <code class="sourceCode haskell">shiftPoly</code> are equivalent.</p>
<h2 id="computation-pattern-folding">Computation Pattern: Folding</h2>
<p>Once you’ve put on the FP goggles, you start seeing computation patterns everywhere.</p>
<p>Lets write a function that <em>adds</em> all the elements of a list.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb8-1" data-line-number="1">listAdd []     <span class="fu">=</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2">listAdd (x<span class="fu">:</span>xs) <span class="fu">=</span> x <span class="fu">+</span> listAdd xs</a></code></pre></div>
<p>Next, a function that <em>multiplies</em> the elements of a list.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb9-1" data-line-number="1">listMul []     <span class="fu">=</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2">listMul (x<span class="fu">:</span>xs) <span class="fu">=</span> x <span class="fu">*</span> (listMul xs)</a></code></pre></div>
<p>Can you see the pattern? Again, the only bits that are different are the <code class="sourceCode haskell">base</code> case value, and the <code class="sourceCode haskell">op</code> being performed at each step. We’ll just turn those into parameters, and lo!</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb10-1" data-line-number="1">foldr op base []     <span class="fu">=</span> base</a>
<a class="sourceLine" id="cb10-2" data-line-number="2">foldr op base (x<span class="fu">:</span>xs) <span class="fu">=</span> x <span class="ot">`op`</span> (foldr op base xs)</a></code></pre></div>
<p>Now, each of the individual functions are just specific instances of the general <code class="sourceCode haskell">foldr</code> pattern.</p>

<p>To develop some intuition about <code class="sourceCode haskell">foldr</code> lets “run” it a few times by hand.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb11-1" data-line-number="1">foldr op base [x1,x2,<span class="fu">...</span>,xn]</a>
<a class="sourceLine" id="cb11-2" data-line-number="2">  <span class="fu">==</span> <span class="co">{- unfold -}</span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3">     x1 <span class="ot">`op`</span> (foldr op base [x2,<span class="fu">...</span>,xn])</a>
<a class="sourceLine" id="cb11-4" data-line-number="4">  <span class="fu">==</span> <span class="co">{- unfold -}</span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5">     x1 <span class="ot">`op`</span> (x2 <span class="ot">`op`</span> (foldr op base [<span class="fu">...</span>,xn]))</a>
<a class="sourceLine" id="cb11-6" data-line-number="6">  <span class="fu">==</span> <span class="co">{- unfold -}</span></a>
<a class="sourceLine" id="cb11-7" data-line-number="7">     x1 <span class="ot">`op`</span> (x2 <span class="ot">`op`</span> (<span class="fu">...</span> <span class="ot">`op`</span> (xn <span class="ot">`op`</span> base)))</a></code></pre></div>
<p>Aha! It has a rather pleasing structure that mirrors that of lists; the <code class="sourceCode haskell"><span class="fu">:</span></code> is replaced by the <code class="sourceCode haskell">op</code> and the <code class="sourceCode haskell">[]</code> is replaced by <code class="sourceCode haskell">base</code>. Thus, can you see how to use it to eliminate recursion from the recursion from</p>

<p><strong>QUIZ</strong></p>
<p>Which of these is a valid implementation of <code class="sourceCode haskell">listLen</code></p>
<p>A. <code class="sourceCode haskell">listLen <span class="fu">=</span> foldr (\n <span class="ot">-&gt;</span> n <span class="fu">+</span> <span class="dv">1</span>) <span class="dv">0</span></code> B. <code class="sourceCode haskell">listLen <span class="fu">=</span> foldr (<span class="fu">+</span> <span class="dv">1</span>) <span class="dv">0</span></code> C. <code class="sourceCode haskell">listLen <span class="fu">=</span> foldr (\_ n <span class="ot">-&gt;</span> n <span class="fu">+</span> <span class="dv">1</span>) <span class="dv">0</span></code> D. <code class="sourceCode haskell">listLen <span class="fu">=</span> foldr (\x xs <span class="ot">-&gt;</span> <span class="dv">1</span> <span class="fu">+</span> listLen xs) <span class="dv">0</span></code> E. All of the above</p>
<p>How would you use it to eliminate the recursion from</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb12-1" data-line-number="1">factorial <span class="dv">0</span> <span class="fu">=</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2">factorial n <span class="fu">=</span> n <span class="fu">*</span> factorial (n<span class="fu">-</span><span class="dv">1</span>)</a></code></pre></div>

<p>One last pattern exercise. How about this fellow from last lecture:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="ot">fuseActions ::</span> [<span class="dt">IO</span> ()] <span class="ot">-&gt;</span> <span class="dt">IO</span> ()</a>
<a class="sourceLine" id="cb13-2" data-line-number="2">fuseActions []        <span class="fu">=</span> return ()</a>
<a class="sourceLine" id="cb13-3" data-line-number="3">fuseActions (a1<span class="fu">:</span>acts) <span class="fu">=</span> <span class="kw">do</span> a1</a>
<a class="sourceLine" id="cb13-4" data-line-number="4">                           fuseActions acts</a></code></pre></div>
<p>Can you spot the pattern?</p>

<h1 id="computing-over-trees">Computing Over Trees</h1>
<p>We have (and will continue) to see that trees are crucial pillar upon which many data structures are built in Haskell. The workhorse, lists, are infact a kind of tree with exactly one child. Lets write some functions over trees.</p>
<p>First, here is a function that computes the <em>height</em> of a tree.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="ot">height ::</span> <span class="dt">Tree</span> a <span class="ot">-&gt;</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2">height (<span class="dt">Leaf</span> _)   <span class="fu">=</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb14-3" data-line-number="3">height (<span class="dt">Node</span> l r) <span class="fu">=</span> <span class="dv">1</span> <span class="fu">+</span> max (height l) (height l)</a></code></pre></div>
<p>The readability of the above, makes an English description redundant! Good old recursion. You have a base case for the <code class="sourceCode haskell"><span class="dt">Leaf</span></code> pattern (namely <code class="sourceCode haskell"><span class="dv">0</span></code>) and a recursive or inductive case for the <code class="sourceCode haskell"><span class="dt">Node</span></code> pattern (namely the larger of the recursively computed heights of the left and right subtrees.) Lets give it a whirl</p>

<div class="sourceCode" id="cb15"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb15-1" data-line-number="1">ghci<span class="fu">&gt;</span> height st1</a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="dv">1</span></a>
<a class="sourceLine" id="cb15-3" data-line-number="3"></a>
<a class="sourceLine" id="cb15-4" data-line-number="4">ghci<span class="fu">&gt;</span> height st3</a>
<a class="sourceLine" id="cb15-5" data-line-number="5"><span class="dv">2</span></a></code></pre></div>
<p>How do we compute the <em>number</em> of leaf elements in the tree?</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="ot">size            ::</span> <span class="dt">Tree</span> a <span class="ot">-&gt;</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb16-2" data-line-number="2">size (<span class="dt">Leaf</span> _)   <span class="fu">=</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb16-3" data-line-number="3">size (<span class="dt">Node</span> l r) <span class="fu">=</span> (size l) <span class="fu">+</span> (size l)</a></code></pre></div>
<p>How about a function that gathers all the elements that occur as leaves of the tree:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="ot">toList ::</span> <span class="dt">Tree</span> a <span class="ot">-&gt;</span> [a] </a>
<a class="sourceLine" id="cb17-2" data-line-number="2">toList (<span class="dt">Leaf</span> x)   <span class="fu">=</span> [x]</a>
<a class="sourceLine" id="cb17-3" data-line-number="3">toList (<span class="dt">Node</span> l r) <span class="fu">=</span> (toList l) <span class="fu">++</span> (toList r)</a></code></pre></div>
<h2 id="computation-pattern-tree-fold">Computation Pattern: Tree Fold</h2>
<p>Did you spot the pattern? What are the different bits? The base value and the operation? So we can write a tree folding routine as</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb18-1" data-line-number="1">treeFold op b (<span class="dt">Leaf</span> x)   <span class="fu">=</span> b</a>
<a class="sourceLine" id="cb18-2" data-line-number="2">treeFold op b (<span class="dt">Node</span> l r) <span class="fu">=</span> (treeFold op b l) <span class="ot">`op`</span> (treeFold op b r)</a></code></pre></div>
<p>Does that work? Well, we can easily check that</p>
<h2 id="quiz">Quiz</h2>
<p>What does <code class="sourceCode haskell">treeFold (<span class="fu">+</span>) <span class="dv">1</span> t</code> return?</p>
<ol type="a">
<li><code class="sourceCode haskell"><span class="dv">0</span></code></li>
<li>the <em>largest</em> element in the tree</li>
<li>the <em>height</em> of the tree</li>
<li>the <em>number-of-leaves</em> of the tree</li>
<li>type <em>error</em></li>
</ol>
<h2 id="quiz-1">Quiz</h2>
<p>What does <code class="sourceCode haskell">treeFold max <span class="dv">0</span> t</code> return?</p>
<ol type="a">
<li><code class="sourceCode haskell"><span class="dv">0</span></code></li>
<li>the <em>largest</em> element in the tree</li>
<li>the <em>height</em> of the tree</li>
<li>the <em>number-of-leaves</em> of the tree</li>
<li>type <em>error</em></li>
</ol>
<p>But what about <code class="sourceCode haskell">toList</code> ? Urgh. Does. Not. Work. We painted ourselves into a corner. For <code class="sourceCode haskell">size</code> and <code class="sourceCode haskell">height</code> the base value is a constant, but for <code class="sourceCode haskell">toList</code> the base value <em>depends on</em> the actual datum at the leaf! Thus, we need <em>two</em> operations: one to combine the results of the left and right subtrees, and another to give us the value at a leaf. In other words, the base <code class="sourceCode haskell">b</code> needs to be a <em>function</em> that takes as input the leaf value and returns as output the result of folding over the leaf.</p>

<p>Now we can write the <code class="sourceCode haskell">size</code> as</p>

<p>How would you write <code class="sourceCode haskell">height</code> ?</p>

<p>where <code class="sourceCode haskell">const <span class="dv">0</span></code> and <code class="sourceCode haskell">const <span class="dv">1</span></code> are the respective base functions that ignore the leaf value and just always return <code class="sourceCode haskell"><span class="dv">0</span></code> and <code class="sourceCode haskell"><span class="dv">1</span></code> respectively.</p>
<p>Can you guess the definition of <code class="sourceCode haskell">const</code> ?</p>
<h2 id="quiz-2">Quiz</h2>
<p>Which of the following implements <code class="sourceCode haskell"><span class="ot">toList ::</span> <span class="dt">Tree</span> a <span class="ot">-&gt;</span> [a]</code></p>
<ol type="a">
<li><code class="sourceCode haskell">toList <span class="fu">=</span> treeFold (<span class="fu">:</span>)  []</code></li>
<li><code class="sourceCode haskell">toList <span class="fu">=</span> treeFold (<span class="fu">++</span>) []</code></li>
<li><code class="sourceCode haskell">toList <span class="fu">=</span> treeFold (<span class="fu">:</span>)  (\x <span class="ot">-&gt;</span> [x])</code></li>
<li><code class="sourceCode haskell">toList <span class="fu">=</span> treeFold (<span class="fu">++</span>) (\x <span class="ot">-&gt;</span> [x])</code></li>
<li>none of the above.</li>
</ol>
<p>What about the equivalent of <code class="sourceCode haskell">map</code> for <code class="sourceCode haskell"><span class="dt">Tree</span></code>s ? We could write the recursive definition</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="ot">treeMap ::</span> (a <span class="ot">-&gt;</span> b) <span class="ot">-&gt;</span> <span class="dt">Tree</span> a <span class="ot">-&gt;</span> <span class="dt">Tree</span> b</a>
<a class="sourceLine" id="cb19-2" data-line-number="2">treeMap f (<span class="dt">Leaf</span> x)   <span class="fu">=</span> <span class="dt">Leaf</span> (f x)</a>
<a class="sourceLine" id="cb19-3" data-line-number="3">treeMap f (<span class="dt">Node</span> l r) <span class="fu">=</span> <span class="dt">Node</span> (treeMap f l) (treeMap f r)</a></code></pre></div>
<p>but recursion is <strong>HARD TO READ</strong> do we really have to use it ?</p>
<p><strong>DO IN CLASS</strong></p>
<p>Sweet! see how we just used the constructors as functions! Lets take it out for a spin.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb20-1" data-line-number="1">ghci<span class="fu">&gt;</span> st1</a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="dt">Node</span> (<span class="dt">Leaf</span> <span class="st">&quot;cat&quot;</span>) (<span class="dt">Leaf</span> <span class="st">&quot;doggerel&quot;</span>)</a>
<a class="sourceLine" id="cb20-3" data-line-number="3">ghci<span class="fu">&gt;</span> treeMap length st1</a>
<a class="sourceLine" id="cb20-4" data-line-number="4"><span class="dt">Node</span> (<span class="dt">Leaf</span> <span class="dv">3</span>) (<span class="dt">Leaf</span> <span class="dv">8</span>)</a>
<a class="sourceLine" id="cb20-5" data-line-number="5"></a>
<a class="sourceLine" id="cb20-6" data-line-number="6">ghci<span class="fu">&gt;</span> st2</a>
<a class="sourceLine" id="cb20-7" data-line-number="7"><span class="dt">Node</span> (<span class="dt">Leaf</span> <span class="st">&quot;piglet&quot;</span>) (<span class="dt">Leaf</span> <span class="st">&quot;hippopotamus&quot;</span>)</a>
<a class="sourceLine" id="cb20-8" data-line-number="8">ghci<span class="fu">&gt;</span> treeMap reverse st2</a>
<a class="sourceLine" id="cb20-9" data-line-number="9"><span class="dt">Node</span> (<span class="dt">Leaf</span> <span class="st">&quot;telgip&quot;</span>) (<span class="dt">Leaf</span> <span class="st">&quot;sumatopoppih&quot;</span>)</a></code></pre></div>
<h1 id="spotting-patterns-in-the-real-world">Spotting Patterns In The “Real” World</h1>
<p>It was all well and good to see the patterns in tiny “toy” functions. Needless to say, these patterns appear regularly in “real” code, if only you know to look for them. Next, we will develop a small library that “swizzles” text files.</p>
<ol type="1">
<li><p>We will start with a beginner’s version that is riddled with <a href="swizzle-v0.html">explicit recursion</a>.</p></li>
<li><p>Next, we will try to spot the patterns and eliminate recursion using <a href="swizzle-v1.html">higher-order functions</a>.</p></li>
<li><p>Finally, we will <a href="swizzle-v2.html">parameterize</a> the code so that we can both “swizzle” and “unswizzle” without duplicate code.</p></li>
</ol>
<h2 id="exercise">Exercise</h2>
<p>Needless to say, the code can be cleaned up even more, and I encourage you to do so. For example, rewrite the code that swizzles <code class="sourceCode haskell"><span class="dt">Char</span></code> so that instead of using association lists, it uses the more efficient <code class="sourceCode haskell"><span class="dt">Map</span> k v</code> (maps from keys <code class="sourceCode haskell">k</code> to values <code class="sourceCode haskell">v</code>) type in the standard library module <code class="sourceCode haskell"><span class="dt">Data.Map</span></code>.</p>
<h2 id="which-is-more-readable-hofs-or-recursion">Which is more readable? HOFs or Recursion</h2>
<p>As a beginner, you might think that the recursive versions of <code class="sourceCode haskell">toUpperString</code> and <code class="sourceCode haskell">shiftPoly</code> are easier to follow than the <code class="sourceCode haskell">map</code> versions. Certainly, <code class="sourceCode haskell">fold</code> takes a bit of getting used to.</p>
<p>However, as you get used to the light, you will find the latter is infact far easier to follow, because once abstraction gets into your bones you’ll know exactly what an instance does at a single glance.</p>
<p>In contrast, recursion is lower-level, so every time you see a recursive function, you have to understand how the knots are tied, and worse, there is potential for making silly off-by-one type errors if you re-jigger the basic strategy every time.</p>
<p>As an added bonus, it can be quite useful and profitable to <em>parallelize</em> and <em>distribute</em> the computation patterns (like <code class="sourceCode haskell">map</code> and <code class="sourceCode haskell">fold</code>) in just one place, thereby allowing arbitrary hundreds or thousands of instances to <a href="http://en.wikipedia.org/wiki/MapReduce" title="MapReduce">benefit in a single shot!</a></p>
                <hr>
            </div>
        </div>
    </div>
</article>

        </div>
        <div id="footer">
        </div>
      <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="https://ucsd-cse230.github.io/sp20/feed.xml" data-datatype="json" data-type="GET" data-target="#frame" class="reload" id="clickme">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="https://twitter.com/ranjitjhala" data-datatype="json" data-type="GET" data-target="#frame" class="reload" id="clickme" target="_blank">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://plus.google.com/u/0/104385825850161331469" data-datatype="json" data-type="GET" data-target="#frame" class="reload" id="clickme" target="_blank">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-google-plus fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://github.com/ranjitjhala" target="_blank">
                            <span class="fa-stack fa-lg">

                              <i class="fa fa-arrow-circle-o-down"></i>
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
		    
                </ul>
                <p class="copyright text-muted">
                
                  Generated by <a href="http://jaspervdj.be/hakyll">Hakyll</a>,
                  template by <a href="http://lucumr.pocoo.org">Armin Ronacher</a>,
                  suggest improvements <a href="https://github.com/ucsd-progsys/liquidhaskell-blog/">here</a>.
                </p>
            </div>
        </div>
    </div>
</footer>


<!-- jQuery -->
<script src="https://ucsd-cse230.github.io/sp20/static/js/jquery.min.js"></script>
<script src="https://ucsd-cse230.github.io/sp20/static/js/spaceg.stylesheets.min.js"></script>
<script src="https://ucsd-cse230.github.io/sp20/static/js/bootstrap.min.js"></script>
<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>
<script src="https://ucsd-cse230.github.io/sp20/static/js/anim.js"></script>
<script src="https://ucsd-cse230.github.io/sp20/static/js/scripts.js"></script>

    </body>
</html>
